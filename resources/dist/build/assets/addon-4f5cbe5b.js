const{Mark:f,getMarkRange:b,getAttributes:_}=Statamic.$bard.tiptap.core,{Plugin:y,PluginKey:k,TextSelection:x}=Statamic.$bard.tiptap.pm.state,g=f.create({name:"ruby",parseHTML(){return[{tag:"ruby",contentElement:"span",getAttrs:e=>({text:e.querySelector("rt").textContent})}]},renderHTML({mark:e}){return["ruby",{},["span",{},0],["rt",{contenteditable:!1},e.attrs.text]]},addAttributes(){return{text:{default:null}}},addCommands(){return{toggleRuby:e=>({commands:t})=>e.text?t.setMark(this.name,e):t.unsetMark(this.name,{extendEmptyMarkRange:!0})}},addProseMirrorPlugins(){const e=this.options.bard;return[new y({key:new k("eventHandler"),props:{handleClick(t,r){const{schema:s,doc:o,tr:d}=t.state,l=b(o.resolve(r),s.marks.ruby);if(l){if(l.to===r)return;const u=o.resolve(l.from),n=o.resolve(l.to),a=new x(u,n),p=d.setSelection(a),c=_(t.state,s.marks.ruby);t.dispatch(p),e.$emit("ruby-selected",c)}else e.$emit("ruby-deselected")}}})]}});function h(e,t,r,s,o,d,l,u){var n=typeof e=="function"?e.options:e;t&&(n.render=t,n.staticRenderFns=r,n._compiled=!0),s&&(n.functional=!0),d&&(n._scopeId="data-v-"+d);var a;if(l?(a=function(i){i=i||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!i&&typeof __VUE_SSR_CONTEXT__<"u"&&(i=__VUE_SSR_CONTEXT__),o&&o.call(this,i),i&&i._registeredComponents&&i._registeredComponents.add(l)},n._ssrRegister=a):o&&(a=u?function(){o.call(this,(n.functional?this.parent:this).$root.$options.shadowRoot)}:o),a)if(n.functional){n._injectStyles=a;var p=n.render;n.render=function(v,m){return a.call(m),p(v,m)}}else{var c=n.beforeCreate;n.beforeCreate=c?[].concat(c,a):[a]}return{exports:e,options:n}}const C={props:{bard:{},markAttrs:Object},data(){return{text:null}},created(){this.applyAttrs(this.markAttrs),this.bard.$on("ruby-selected",this.applyAttrs),this.bard.$on("ruby-deselected",()=>this.$emit("deselected"))},mounted(){this.$nextTick(()=>{setTimeout(()=>{this.$refs.textInput.focus()},50)})},beforeDestroy(){this.bard.$off("ruby-selected"),this.bard.$off("ruby-deselected")},methods:{applyAttrs(e){this.text=e.text},remove(){this.$emit("updated",{text:null})},commit(){this.$emit("updated",{text:this.text})}}};var $=function(){var t=this,r=t._self._c;return r("div",{staticClass:"bard-link-toolbar"},[r("div",{staticClass:"px-4 py-4 border-b dark:border-dark-900"},[r("div",{staticClass:"h-8 p-2 bg-gray-100 dark:bg-dark-600 text-gray-800 dark:text-dark-150 w-full border dark:border-dark-200 rounded shadow-inner placeholder:text-gray-600 dark:placeholder:dark-text-dark-175 flex items-center"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.text,expression:"text"}],ref:"textInput",staticClass:"input h-auto text-sm",attrs:{type:"text",placeholder:t.__("Enter ruby textâ€¦")},domProps:{value:t.text},on:{keydown:function(s){return!s.type.indexOf("key")&&t._k(s.keyCode,"enter",13,s.key,"Enter")?null:(s.preventDefault(),t.commit.apply(null,arguments))},input:function(s){s.target.composing||(t.text=s.target.value)}}})])]),r("footer",{staticClass:"bg-gray-100 dark:bg-dark-575 rounded-b-md flex items-center justify-end space-x-3 font-normal p-2"},[r("button",{staticClass:"text-xs text-gray-600 dark:text-dark-175 hover:text-gray-800 dark:hover-text-dark-100",on:{click:function(s){return t.$emit("canceled")}}},[t._v(" "+t._s(t.__("Cancel"))+" ")]),r("button",{staticClass:"btn btn-sm",on:{click:t.remove}},[t._v(" "+t._s(t.__("Remove"))+" ")]),r("button",{staticClass:"btn btn-sm",on:{click:t.commit}},[t._v(" "+t._s(t.__("Apply"))+" ")])])])},V=[],A=h(C,$,V,!1,null,null,null,null);const w=A.exports,R={mixins:[BardToolbarButton],components:{RubyPanel:w},data(){return{markAttrs:null,panelActive:!1}},methods:{open(){this.panelActive=!this.panelActive,this.panelActive?this.markAttrs=this.editor.getAttributes("ruby"):this.editor.commands.focus()},close(){this.panelActive=!1,this.$refs.popover.close()},popoverClosed(){this.panelActive=!1},update(e){this.editor.chain().focus().toggleRuby(e).run(),this.markAttrs=null,this.close()}}};var H=function(){var t=this,r=t._self._c;return r("popover",{ref:"popover",attrs:{placement:"bottom-start",clickaway:!1},on:{closed:t.popoverClosed},scopedSlots:t._u([{key:"trigger",fn:function(){return[r("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.button.text,expression:"button.text"}],staticClass:"bard-toolbar-button",class:{active:t.active},attrs:{"aria-label":t.button.text},on:{click:t.open}},[r("svg",{staticStyle:{"fill-rule":"evenodd","clip-rule":"evenodd","stroke-linejoin":"round","stroke-miterlimit":"2"},attrs:{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg","xml:space":"preserve"}},[r("path",{attrs:{d:"M3.542 9.978h5.464v1.987H3.542V9.978Zm6.976 0h5.422v1.987h-5.422V9.978Zm5.422-1.231h-5.422V6.76h5.422v1.987Zm-6.934 0H3.542V6.76h5.464v1.987ZM.367 1.965v1.469h8.639V5.4H2.03v7.948h5.486c-1.339 1.706-3.844 3.239-7.516 4.6l.864 1.382c3.931-1.663 6.587-3.65 7.97-5.982h.172V20h1.512v-6.652h.152c1.598 2.419 4.341 4.384 8.228 5.874l.67-1.425c-3.412-1.08-5.939-2.549-7.538-4.449h5.421V5.4h-6.933V3.434h8.64V1.965h-8.64V0H9.006v1.965H.367Z",fill:"currentColor"}})])])]},proxy:!0},{key:"default",fn:function(){return[t.panelActive?r("ruby-panel",{ref:"toolbar",attrs:{"mark-attrs":t.markAttrs,bard:t.bard},on:{updated:t.update,canceled:t.close}}):t._e()]},proxy:!0}])})},S=[],M=h(R,H,S,!1,null,null,null,null);const T=M.exports;Statamic.booting(()=>{Statamic.$components.register("ruby-button",T),Statamic.$bard.addExtension(({bard:e})=>g.configure({bard:e})),Statamic.$bard.buttons((e,t)=>t({name:"ruby",text:"Ruby Text",html:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><path d="M3.542 9.978h5.464v1.987H3.542V9.978Zm6.976 0h5.422v1.987h-5.422V9.978Zm5.422-1.231h-5.422V6.76h5.422v1.987Zm-6.934 0H3.542V6.76h5.464v1.987ZM.367 1.965v1.469h8.639V5.4H2.03v7.948h5.486c-1.339 1.706-3.844 3.239-7.516 4.6l.864 1.382c3.931-1.663 6.587-3.65 7.97-5.982h.172V20h1.512v-6.652h.152c1.598 2.419 4.341 4.384 8.228 5.874l.67-1.425c-3.412-1.08-5.939-2.549-7.538-4.449h5.421V5.4h-6.933V3.434h8.64V1.965h-8.64V0H9.006v1.965H.367Z" fill="currentColor" /></svg>',activeName:"ruby",component:"ruby-button"}))});
